import{f as y,n as D,a1 as k,a2 as I,a3 as C,e as f,a4 as S,a5 as _,D as x,a6 as z,m as R,p as A,a7 as B}from"./index-DWSgxYrt.js";import{a as G,b as K}from"./app-DV0NUql3.js";function P(e){return S()?(_(e),!0):!1}function g(){const e=new Set,n=o=>{e.delete(o)};return{on:o=>{e.add(o);const t=()=>n(o);return P(t),{off:t}},off:n,trigger:(...o)=>Promise.all(Array.from(e).map(t=>t(...o)))}}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const T=()=>{};function W(...e){if(e.length!==1)return k(...e);const n=e[0];return typeof n=="function"?I(C(()=>({get:n,set:T}))):f(n)}function E(e,n,r){const a=y(e,(o,t,i)=>{o&&(r!=null&&r.once&&D(()=>a()),n(o,t,i))},{...r,once:!1});return a}var p=(e=>(e.Init="init",e.Verified="verified",e.Expired="expired",e.Error="error",e))(p||{});function F({root:e=f(),options:n={}}){const r=G(),a=f(),o=K(),t=g(),i=g(),l=g(),c=W(e),u=f("init");return E(c,async v=>{const d=await o.render(v,{...n,sitekey:r,callback:t.trigger,"expired-callback":i.trigger,"error-callback":l.trigger});a.value=d}),t.on(()=>{u.value="verified"}),i.on(()=>{u.value="expired"}),l.on(()=>{u.value="error"}),{root:c,widgetID:a,execute(){typeof a.value<"u"&&o.execute(a.value)},reset(){u.value="init",typeof a.value<"u"&&o.reset(a.value)},state:u,onVerify:t.on,onExpired:i.on,onError:l.on}}function H(e,n,r){const{root:a,state:o,widgetID:t,onError:i,onExpired:l,onVerify:c,reset:u,execute:v}=F({options:e||{}}),d=x(()=>o.value===p.Expired),V=x(()=>o.value===p.Error),b=x(()=>o.value===p.Verified);return E(t,s=>{r("load",s),r("update:widgetId",s)}),y(n,(s,h)=>{!s&&h&&!d.value&&m()}),l(()=>{r("update:modelValue",null),r("expired",t.value)}),i(s=>{r("error",s)}),c(s=>{r("success",s),r("update:modelValue",s)}),{root:a,widgetID:t,state:o,isError:V,isExpired:d,isVerified:b,reset:m,execute:v};function m(){u(),w()}function w(){r("update:modelValue",null)}}const j=z({props:{as:{default:"div"},widgetId:null,size:{default:"normal"},theme:{default:"light"},tabindex:null,modelValue:null},emits:["load","error","expired","success","update:widgetId","update:modelValue"],setup(e,{emit:n}){const r=e,{root:a}=H({theme:r.theme,size:r.size,tabindex:r.tabindex},k(r,"modelValue"),n);return(o,t)=>(R(),A(B(e.as),{ref_key:"root",ref:a},null,512))}});export{j as _};
